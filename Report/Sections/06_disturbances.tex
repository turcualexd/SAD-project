\section{Disturbances analysis}
\label{sec:disturbances_analysis}

In order to make a realistic simulation of the rotating motion of the spacecraft, the disturbances caused by the environment must be taken into account. The following paragraphs provide a brief introduction to the main disturbances acting on the system. The simulation results for the chosen satellite and orbit will then be presented to aid in the selection of the two most significant disturbances. Since the other disturbances are typically much smaller than the dominant ones (often by some orders of magnitude), they will be disregarded in the final simulation.


\subsection{Magnetic Disturbance}
\label{subsec:dist_mag}

The influence of the Earth's magnetic field on the satellite is relevant due to the proximity of the orbit taken in exam. Besides the crucial role that it plays in the actuation, the magnetic field could also cause big disturbances on the satellite's dynamics. The magnetic torque, whether generated by the magnetorquers or by parasitic currents present in the satellite, follows the general law:

\begin{equation} \label{eq:mag_torque}
    \boldsymbol{M} = \boldsymbol{D} \times \boldsymbol{B}
\end{equation}

where $\boldsymbol{D}$ is the magnetic dipole generated by a coil or by parasitic currents, $\boldsymbol{B}$ is the magnetic field vector.

A mathematical model of the magnetic field is necessary to evaluate $\boldsymbol{B}$ given the satellite position along the orbit. The model chosen for the purpose is the 13th edition of the International Geomagnetic Reference Field (IGRF). According to this model, the magnetic field $\boldsymbol{B}$ is evaluated as the gradient of a magnetic scalar potential $V$, which is modelled as a spherical harmonic expansion of order $N$:

\begin{equation}
	\boldsymbol{B} \left( r, \theta, \phi, t \right) = -\boldsymbol{\nabla} V \left( r, \theta, \phi, t \right)		\qquad
	V \left( r, \theta, \phi, t \right) = a \sum_{n=1}^{N} \sum_{m=0}^{n} \left( \frac{a}{r} \right) ^ {n+1} \left( g^{n,m} (t) \cos m \phi + h^{n,m} (t) \sin m \phi \right) P^{n,m} (\cos \theta)
\end{equation}

where $r, \theta, \phi$ are the spherical coordinates of the satellite in a Earth-Centered Earth-Fixed (ECEF) frame, $a$ is the Earth's equatorial radius (6371.2 km), $P^{n,m} (\cos \theta)$ are the Gauss normalized associated Legendre functions, $g^{n,m} (t)$ and $h^{n,m} (t)$ are the Schmidt semi-normalized spherical harmonic coefficients.
These coefficients are computed from experimental data and depend on time, as the Earth magnetic field is not constant but changes significantly every year. In this simulation, the coefficients refer to year 2020 of IGRF-13 and the expansion is computed up to order 13.

Note that the model must be in the ECEF frame because the magnetic field rotates with the Earth. To adapt the model to an Earth-Centered Inertial (ECI) frame, a rotation matrix is required for the input and its transpose for the output. The matrix takes account of the angular velocity of Earth on time. Lastly, the magnetic field $\boldsymbol{B}$ can be expressed in the body frame through the attitude matrix.

Once that $\boldsymbol{B}$ is defined for every satellite position, the $\boldsymbol{D}$ vector is chosen as an arbitrary constant (based on typical microsat values) and the torque is easily computed along the orbit thanks to \autoref{eq:mag_torque}.


\subsection{SRP Disturbance}
\label{subsec:dist_SRP}

The Solar Radiation Pressure (SRP) torque is the disturbance generated by electromagnetic waves that impact on the spacecraft panels generating force. These forces acting on some of the panels can rise a net torque around the center of mass of the spacecraft. For this analysis, only the Sun radiation is considered, while a more rigorous study should also consider the infrared and the reflected Earth radiation. Moreover, no eclipse condition is analyzed during the simulation, which is a reasonable assumption given the SSO chosen in \autoref{subsec:orbit_characterization}.

The formula to calculate the force acting on each discrete panel $i$ is the following:

\begin{equation}
    \boldsymbol{F_i} = -P A_i \left( \boldsymbol{\hat{S}_B} \cdot \boldsymbol{\hat{N}_{B,i}} \right) \left[ \left( 1 - \rho_s \right) \boldsymbol{\hat{S}_B} + \left( 2 \rho_s \left( \boldsymbol{\hat{S}_B} \cdot \boldsymbol{\hat{N}_{B,i}} \right) + \frac{2}{3} \rho_d \right) \boldsymbol{\hat{N}_{B,i}} \right]
\end{equation}

In order to simulate this kind of disturbance, the coefficients of absorption $\rho_a$, specular reflection $\rho_s$ and diffusion $\rho_d$ must be decided. Since these three parameters are related through an energetic balance as $\rho_a + \rho_d + \rho_s = 1$, only two of them are indipendent while the third follows. These values clearly depends on the material of the main body and the solar panels of the spacecraft.
In order to determine the force on each surface, the geometry of the panels of the satellite must be given (\autoref{subsec:sat_characterization}), in particular the surface of each panel $S_i$ and direction of the normal of the panel $\boldsymbol{\hat{N}_{B,i}}$ expressed in $\mathcal{B}$ frame.
The direction of Sun $\boldsymbol{\hat{S}_B}$ is modeled in ECI frame considering the obliquity $\epsilon = 23.44 \; \deg$ of Earth's rotation axis with respect to the ecliptic plane, then it is rotated in $\mathcal{B}$ frame through the attitude matrix.

Lastly, to be able to compute the torque it must be known where the resulting force acts on each panel (i.e. the centre of SRP force of the panel). It is assumed as a first approximation that the forces act on the geometric center of the corresponding plate. In order to correctly calculate the total torque, a shadow check must be performed. This has been implemented in Simulink by checking the sign of the dot product between the normal versor of the plate $\boldsymbol{\hat{N}_{B,i}}$ and the Sun direction $\boldsymbol{\hat{S}_B}$.


\subsection{Drag Disturbance}
\label{subsec:dist_drag}

Over extended periods, the spacecraft's engagement with the higher strates of Earth's atmosphere results in the generation of a torque around its center of mass. At altitudes less than $400$ kilometers, the aerodynamic torque is usually the predominant factor, though its significance diminishes considerably beyond $700$ kilometers of altitude.

For the simulation, the geometry of the panels is defined in \autoref{subsec:sat_characterization}. The coefficient of drag $C_D$ is set to $2.2$, the relative velocity considers both the rotation of Earth around its axis and the rotation motion of the spacecraft.

As for the SRP case (\autoref{subsec:dist_SRP}), a sort of shadow check has been implemented based on the dot product between the relative velocity and the normal of the surface. This check is required since the modelling of the surface is composed of two faces, but only the external face impacts with the relative air movement.
As for SRP torque, the position of the center of the force $\boldsymbol{r_i}$ should be evaluated for each panel. As a first approximation, the resulting force is placed in the geometric center of the panel.

\begin{equation}
	\begin{gathered}
		\boldsymbol{M} =
		\begin{dcases*}
			\sum_{i=1}^{n} \boldsymbol{r_i} \times \boldsymbol{F_i} &
			if $\boldsymbol{\hat{N}_{B,i}} \cdot \boldsymbol{\hat{v}_{B,i}^{rel}} \geq 0$ \\
			\boldsymbol{0} &
			if $\boldsymbol{\hat{N}_{B,i}} \cdot \boldsymbol{\hat{v}_{B,i}^{rel}} < 0$
		\end{dcases*}
		\qquad \text{with} \\
		\boldsymbol{F_i} = -\frac{1}{2} \rho C_D \lVert \boldsymbol{v_{B,i}^{rel}} \rVert^2 \left( \boldsymbol{\hat{N}_{B,i}} \cdot \boldsymbol{\hat{v}_{B,i}^{rel}} \right) A_i \boldsymbol{\hat{v}_{B,i}^{rel}} \qquad n = \text{number of faces}
	\end{gathered}
\end{equation}

The air density $\rho$ is computed according to the US Standard Atmosphere of 1976. The model uses an exponential law to describe $\rho$ as a function of altitude $h$:

\begin{equation}
	\rho = \rho_0 \cdot \exp \left[ -\frac{h - h_0}{H} \right]
\end{equation}

Considering the orbit defined in \autoref{subsec:orbit_characterization}, the range of altitude is between $450$ and $500$ km. From this information, the constants of the formula are the following \cite{wertz}:

\begin{equation*}
	\rho_0 = 1.585 \cdot 10^{-12} \; \text{kg/m}^3 \qquad
	h_0 = 450 \; \text{km} \qquad
	H = 60.828 \; \text{km}
\end{equation*}


\subsection{Gravity Gradient Disturbance}
\label{subsec:dist_GG}

Since the gravity around the spacecraft is not uniform, a non-negligible gravity torque will arise from there. Studying the torque generated by an elementary force acting on the elementary mass $\mathrm{d}m$ the equation for this is obtained:

\begin{equation}
	\mathrm{d} \boldsymbol{M} = -\boldsymbol{r} \times \frac{G m_t \mathrm{d}m}{\lVert \boldsymbol{R} + \boldsymbol{r} \rVert ^3} \left( \boldsymbol{R} + \boldsymbol{r} \right)
\end{equation}

where $\boldsymbol{r}$ is the distance of $\mathrm{d}m$ from the center of mass and $\boldsymbol{R}$ is the distance of the center of mass from the center of Earth.
Approximating this equation, and expressing the position vector of the centre of mass as the product of magnitude (\( R \)) with the direction cosines, 
itâ€™s possible to centre this torque in the principal inertia axes. Integrating this equation the final form is achieved.

\begin{equation}
	\begin{aligned}
		M_x &= \frac{3Gm_t}{R^3} (I_z - I_y)c_2c_3 \\
		M_y &= \frac{3Gm_t}{R^3} (I_x - I_z)c_1c_3 \\
		M_z &= \frac{3Gm_t}{R^3} (I_y - I_x)c_1c_2
	\end{aligned}
\end{equation}

\rfig{gg_stab.pdf}{GG stability of satellite}{gg_stab}{0.3}

The \( c_1, c_2 \) and \( c_3 \) are the direction cosines of the radial direction in the principal axes. 
Therefore if one of the principal axes is aligned with the radial direction the torque will be zero because only one of the direction cosines is non-zero.
It's clear that this disturbance acts in a continuous manner throughout the orbit motion and the torque produced depends mainly on the attitude matrix.

Instead, the stability configuration depends on the distribution of mass of the spacecraft with respect to the target orientation. For our case of study, 
inspired by the ESAIL mission from ESA, the satellite is nadir pointing. In particular the $\boldsymbol{x_b}$ direction has to be aligned with the nadir, while the $\boldsymbol{z_b}$ has to be normal with respect to the orbital plane. Using the numerical values of the spacecraft, and the orientation requriements just mentioned this particular configuration results unstable to GG disturbance.


\subsection{Simulation of all disturbances}
\label{subsec:sim_disturbances}

\cfig{disturbances.eps}{Simulation of all disturbances}{disturb_all}{1}

The control-free motion has been simulated with all the disturbances for three full periods. 
The initial condition were set to null initial angular velocity and 
null Euler angles in the $312$ set.

From the graphs of \autoref{fig:disturb_all} it is clear that SRP disturbance is negligible
in our case, the graph shows only numerical zeros. In particular, this is due to the simmetry of 
the geometry of the spacecraft, a small set off for the CoM would have produced a net torque. 
It is clear, that in this specific case, the two most relevant disturbances are due to magnetic field
interaction and the gravity gradient torque since the atmospehric drag torque is some orders of magnitude 
smaller.

Note that in the Gravity Gradient torque the y-axis component is almost null compared to the other 
components along x and z, this is due to the fact that the y-axis component of the torque depends on 
the difference between inertia moment along x and along z, for our case those two moments of inertia are 
very similar (see \autoref{subsec:sat_characterization}). 