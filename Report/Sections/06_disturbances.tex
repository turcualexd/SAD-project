\section{Disturbances analysis}
\label{sec:disturbances_analysis}

In order to make a realistic simulation of the rotating motion of the spacecraft, the environment 
distrubances has to be taken into account. The preliminary study of these external torques is 
crucial for a realistic simulation. In the following paragraphs a brief introduction will be 
done for all the main disturbances, then the simulation of the specific satellite and orbit
will be presented, mainly to choose the two most relevant disturbances. This choice is reasonable 
since there are always two predominant effects of disturbance, while the other can be supposed small 
(usually some order of magnitude smaller, but always depends on the specific case). 


\subsection{Magnetic Disturbance}
\label{subsec:dist_mag}

The influence of the Earth's magnetic field on the satellite is relevant due to the proximity of the orbit taken in exam. Besides the crucial role that it plays in the actuation, the magnetic field could also cause big disturbances on the satellite's dynamics. The magnetic torque, whether generated by the magnetorquers or by parasitic currents present in the satellite, follows the general law:

\begin{equation}
    \boldsymbol{M} = \boldsymbol{D} \wedge \boldsymbol{B}
\end{equation}

where $\boldsymbol{D}$ is the magnetic dipole generated by a coil or by parasitic currents, $\boldsymbol{B}$ is the magnetic field vector.

A mathematical model of the magnetic field is necessary to evaluate $\boldsymbol{B}$ given the satellite position along the orbit. The model chosen for the purpose is the 13th edition of the International Geomagnetic Reference Field (IGRF). According to this model, the magnetic field $\boldsymbol{B}$ is evaluated as the gradient of a magnetic scalar potential $V$, which is modelled as a spherical harmonic expansion of order $N$:

\begin{equation}
	\boldsymbol{B} \left( r, \theta, \phi, t \right) = -\boldsymbol{\nabla} V \left( r, \theta, \phi, t \right)		\qquad
	V \left( r, \theta, \phi, t \right) = a \sum_{n=1}^{N} \sum_{m=0}^{n} \left( \frac{a}{r} \right) ^ {n+1} \left( g^{n,m} (t) \cos m \phi + h^{n,m} (t) \sin m \phi \right) P^{n,m} (\cos \theta)
\end{equation}

where $r, \theta, \phi$ are the spherical coordinates of the satellite in a Earth-Centered Earth-Fixed (ECEF) frame, $a$ is the Earth's equatorial radius (6371.2 km), $P^{n,m} (\cos \theta)$ are the Gauss normalized associated Legendre functions, $g^{n,m} (t)$ and $h^{n,m} (t)$ are the Schmidt semi-normalized spherical harmonic coefficients.
These coefficients are computed from experimental data and depend on time, as the Earth magnetic field is not constant but changes significantly every year. In this simulation, the coefficients refer to year 2020 of IGRF-13 and the expansion is computed up to order 13.

Note that the model must be in the ECEF frame because the magnetic field rotates with the Earth. To adapt the model to an Earth-Centered Inertial (ECI) frame, a rotation matrix is required for the input and its transpose for the output. The matrix takes account of the angular velocity of the planet on time. Lastly, the magnetic field $\boldsymbol{B}$ can be expressed in the body frame through the attitude matrix.

Once that $\boldsymbol{B}$ is defined for every satellite position, the $\boldsymbol{D}$ vector is chosen as an arbitrary constant (based on typical microsat values) and the torque is easily computed along the orbit thanks to the previous formula.


\subsection{SRP Disturbance}
\label{subsec:dist_SRP}

SRP radiation torque is the disturbance generated by electromagnetic waves that impacts on
the spacecraft panels and generate a force. These forces acting on some of the panels could give rise to 
a net torque around the center of mass of the spacecraft. Only sun radiation will be considered 
in this case, a more deep analysis should consider infrared Earth radiation and reflected Earth radiation. 
In addition, no eclipse condition will be analyzed during all the simulation, a reasonable assumption for the 
sun-synchronous case orbit.

The formula to calculate the force acting on each discrete panel is:

\begin{equation}
    \boldsymbol{F_i} = -PA_i \left( \hat{S}_B \cdot \hat{N}_{B,i}\ \right) \left[ \left(1 - \rho_s \right)\hat{S}_B + \left(2\rho_s\left( \hat{S}_B \cdot \hat{N}_{B,i}\ \right) + \frac{2}{3}\rho_d \right) \hat{N}_{B,i}\right] 
\end{equation}

In order to simulate this kind of disturbance the coefficients of absorption, specular reflection and diffusion
has to be decided. These values clearly depends on the material that will be choosen to construct the main body
of the spacecraft, and the solar panels. Since these parameters are related through an energetic balance, we could 
only decide two of them and the third follows. In order to determine the force on each surface, also the geometry of
the panels of the satellite has to be given, in particular size of each 
panel(fully defined in section ...) and direction of the normal of the panel
in $\mathcal{B}$ frame. The direction of sun $\hat{S}_B$, has been firstly modeled in ECI frame considering the obliquity
$\epsilon$ of earth's rotation axis with respect to the ecliptic plane, then through attitude matrix, the unit vector $\hat{S}_B$
has been computed. Lastly, to caluclate the torque we should known where the resulting force on each panel acts (i.e. the centre of
SRP force for each panel). No detailed calulation has been made on this aspect, it is assumed as first approximation that the 
forces acts on the geometric center of the corresponding plate. Also, in order to correctly calculate the total
torque a shadow check must be performed, this is simply implementated in Simulink by checkin the sign
of the dot product of the normal versor of the plate and the sun direction.


\subsection{Drag Disturbance}
\label{subsec:dist_drag}

Over extended periods, the spacecraft's engagement with the higher strates of Earth's atmosphere results
in the generation of a torque around its mass center. This influence may not be trivial. At altitudes 
less than 400 kilometers, the aerodynamic torque is the predominant factor, though its significance diminishes 
considerably beyond 700 kilometers altitude. For the simulation, the panels are considered from geometry data of section (..ref)
the coefficient of drag $C_d$ has been set to $2.2$, the relative velocity consideres the rotation of Earth around its axis and also 
the rotation motion of the spacecraft. As for the SRP case, a sort of shadow check has to be implemented based on the dot product between 
the relative velocity and the normal of the surface. This check is required since the modelling of the surface is composed of two faces, usually
one impacts with the relative air movement while the other is behind and doesn't impact. As for SRP disturbance, for the drag torque the 
vector $r_i$ as distance of centre of pressure to centre of mass, should be evaluated. As a first approximation, the point of action of the 
force for each face is the middle point of the surface under consideration.

\begin{equation}
	\begin{gathered}
		T_{AERO} =
		\begin{dcases*}
			\sum_{i=1}^{n} \vec{r}_i \times \vec{F}_i & if $\vec{N}_{bi} \cdot \vec{v}^{b}_{rel} \geq 0$ \\
			0 & if $\vec{N}_{bi} \cdot \vec{v}^{b}_{rel} < 0$
		\end{dcases*}
		\qquad \text{with} \\
		\vec{F}_i = -\frac{1}{2} \rho C_D v_{rel}^2 \vec{v}_{rel}^{b} (\vec{N}_{bi} \cdot \vec{v}_{rel}^{b}) A_i \qquad \text{n=number of faces}
	\end{gathered}
\end{equation}

\subsection{Gravity Gradient Disturbance}
\label{subsec:dist_GG}

The gravity gradient disturbance account for the fact that the gravity around the spacecraft is not uniform, hence a non-negligible torque 
will arise from there.
Studying the torque generated by an elementary force acting on the elementary mass \( dm \) the equation for this is obtained:

\begin{equation}
	dM = -\mathbf{r} \times \frac{Gm_t dm}{|\mathbf{R} + \mathbf{r}|^3} (\mathbf{R} + \mathbf{r})
\end{equation}

Where \( \mathbf{r} \) is the distance of \( dm \) from the centre of mass and \( \mathbf{R} \) is the distance of the centre of mass from the centre of the Earth. 
Approximating this equation, and expressing the position vector of the centre of mass as the product of magnitude (\( R \)) with the direction cosines, 
itâ€™s possible to centre this torque in the principal inertia axes. Integrating this equation the final form is achieved.

\begin{equation}
	\begin{aligned}
		M_x &= \frac{3Gm_t}{R^3} (I_z - I_y)c_2c_3 \\
		M_y &= \frac{3Gm_t}{R^3} (I_x - I_z)c_1c_3 \\
		M_z &= \frac{3Gm_t}{R^3} (I_y - I_x)c_1c_2
	\end{aligned}
\end{equation}

The \( c_1, c_2 \) and \( c_3 \) are the direction cosines of the radial direction in the principal axes. 
Therefore if one of the principal axes is aligned with the radial direction the torque will be zero because only one of the direction cosines is non-zero.
It's clear that this disturbance acts in a continuous manner throughout the orbit motion and the torque produced depends mainly on the attitude matrix.

Instead, the stability configuration depends on the distribution of mass of the spacecraft with respect to the orientation we want to achieve. For our case of study, 
inspired by the ESAIL mission from ESA, the satellite is nadir pointing. In particular the $\boldsymbol{x_b}$ direction has to be aligned with the nadir, while the $\boldsymbol{z_b}$ has to point the sun for solar panels requirements. Using the numerical values of the spacecraft, and the orientation requriements just mentioned
this particular configuration results unstable to GG disturbance.


\subsection{Simulation of all disturbances}
\label{subsec:sim_disturbances}

\cfig{disturbances.eps}{Simulation of all disturbances}{disturb_all}{1}

The control-free motion has been simulated with all the disturbances for three full periods. 
The initial condition were set to null initial angular velocity and 
null Euler angles in the $312$ set.

From the graphs of \autoref{fig:disturb_all} it is clear that SRP disturbance is negligible
in our case, the graph shows only numerical zeros. In particular, this is due to the simmetry of 
the geometry of the spacecraft a small set off for the CoM would have produced a net torque. 
It is clear, that in this specific case, the two most relevant disturbances are due to magnetic field
interaction and the gravity gradient torque since the atmospehric drag torque is some orders of magnitude 
smaller.

Note that in the Gravity Gradient torque the y-axis component is almost null compared to the other 
components along x and z, this is due to the fact that the y-axis component of the torque depends on 
the difference between inertia moment along x and along z, for our case those two moments of inertia are 
very similar (reference). 